<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Video Messaging</title>
</head>

<body>
    <div id="app"></div>

    <a id="download-video" download="test.webm">Download Video</a>

    <script>
        let start_button = document.createElement("div");
        let stop_button = document.createElement("div");

        start_button.addEventListener("click", async function () {
            let tracks = [];
            // if(screenStream) {
            //     tracks = [...tracks, ...screenStream.getTracks()];
            // }
            let canvasStream = canvas.captureStream();
            tracks = [...canvasStream.getTracks()];
            if (audioStream) {
                tracks = [...tracks, ...audioStream.getTracks()];
            }

            let stream = new MediaStream(tracks);
            media_recorder = new MediaRecorder(stream, {
                mimeType: 'video/webm',
            });

            // event : new recorded video blob available 
            media_recorder.addEventListener('dataavailable', function (e) {
                blobs_recorded.push(e.data);
            });

            // event : recording stopped & all blobs sent
            media_recorder.addEventListener('stop', function () {
                // create local object URL from the recorded video blobs
                let video_local = URL.createObjectURL(new Blob(blobs_recorded, { type: 'video/webm' }));
                download_link.href = video_local;
            });

            // start recording with each recorded blob having 1 second video
            media_recorder.start(1000);
        });

        stop_button.addEventListener('click', function () {
            media_recorder.stop();
        });
    </script>

    <script src="main.js"></script>
</body>

</html>